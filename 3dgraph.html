<head xmlns="http://www.w3.org/1999/html">
    <style> body { margin: 0; }
    #node-caption {
        position: absolute;
        display: none;
        z-index: 100;
    }
    #node-picture {
        position: absolute;
        display: none;
        z-index: 100;
    }
    #paralle{
        position: absolute;
        display: none;
        z-index: 999;
    }
    .checkbox-container {
        position: absolute;
        display: flex;
        z-index: 999;
        justify-content: center;
        top: 10px;
        left: 300px;
    }
    /* Checkbox与标签排列 */
    .checkbox-item {
        z-index: 999;
        margin-right: 15px;

    }
    #Caption{
        position: absolute;
        font-style: italic;
        font-weight: bold;
        z-index: 999;
        top: 10px;
    }
    #result{
        /*position: absolute;*/
        font-style: italic;
        z-index: 999;
        /*top: 40px;*/
        /*left: 480px;*/
        font-size: small;
    }
    .fullscreen-svg {
        width: 100vw;   /* 视口宽度 */
        height: 100vh;  /* 视口高度 */
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }
    #3d-graph {
        width: 1000px;   /* 视口宽度 */
        height: 1000px;  /* 视口高度 */
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }
    #label_check{
        position: absolute;
        /*font-style: italic;*/
        z-index: 999;
        top: 10px;
        left: 340px;
        font-size: small;
    }
    #myCheckbox{
        position: absolute;
        z-index: 999;
        top: 10px;
        left: 450px;
    }

    #ai-caption {
        margin-right: 0px; /* 调整这个值以改变距离 */
    }

    /*#ai-caption {*/
    /*    margin-right: 20px; !* space between ai-caption and ai_dropdown *!*/
    /*}*/

    #ai_dropdown {
        margin-left: 0px; /* space between ai_dropdown and searchInput */
    }

    /*#ai_dropdown{*/
    /*    position: absolute;*/
    /*    left: 60px;*/
    /*    z-index: 999;*/
    /*    top:40px;*/
    /*    width: 200px;*/
    /*}*/
    /*#ai-caption{*/
    /*    position: absolute;*/
    /*    z-index: 999;*/
    /*    top:40px;*/
    /*}*/
    /*#searchInput{*/
    /*    position: absolute;*/
    /*    left: 280px;*/
    /*    z-index: 999;*/
    /*    top:40px;*/
    /*    width: 205px;*/
    /*}*/

    #suggestions{
        position: absolute;
        z-index: 999;
        left: 280px;
        top: 71px;
        max-height: 250px;  /* 或者您希望的任何其他高度 */
        overflow-y: auto;  /* 当内容超出容器时，垂直方向上允许滚动 */
        border: 1px solid #ccc; /* 可选：为下拉菜单添加边框 */
        width: 200px; /* 可选：设置下拉菜单的宽度，或者使其与输入框宽度相匹配 */
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* 可选：为下拉菜单添加轻微的阴影 */

    }
    .element-group {
        position: absolute;
        left: 10px;
        z-index: 999;
        display: flex;
        align-items: center;
        width: 100px;
        top: 40px;
        /* other styles as needed... */
    }

    /*#ai_dropdown {*/
    /*    width: 200px;*/
    /*    margin-right: 20px; !* space between ai_dropdown and searchInput *!*/
    /*}*/
    #attribute_dropdown {
        width: 200px;
        margin-right: 20px; /* space between ai_dropdown and searchInput */
    }

    /*#plus_button{*/
    /*    left: 600px;*/
    /*    position: absolute;*/
    /*    z-index: 999;*/
    /*    top: 40px;*/

    /*}*/

    table {
        border-collapse: collapse;  /* this is necessary for borders to collapse into one */
        border: 1px solid black;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;  /* for padding inside cells */
    }
    th {
        background-color: #f2f2f2;  /* light gray background for headers */
    }

    #details{
        left: 10px;
        position: absolute;
        z-index: 999;

    }
    .duplicated {
        left: 400px;  /* Original 100px + 300px */
    }
    .suggestion-item {
        padding: 8px;
        cursor: pointer;
    }

    .suggestion-item:hover {
        background-color: #eee;
    }

    iframe {
        border: none;

    }
    </style>
    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/@seregpie/three.text-texture"></script>
    <script src="https://unpkg.com/@seregpie/three.text-sprite"></script>
    <script src="//unpkg.com/3d-force-graph"></script>
    <script src="https://unpkg.com/neo4j-driver"></script>
    <script src="https://unpkg.com/neovis.js@2.0.2"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!--<script src="../../dist/3d-force-graph.js"></script>-->
</head>
<title>3D Knowledge Graph Platform</title>
<body>
<input type="text" id="node-caption" />
<!--<svg id="dpp"></svg>-->
<!--<div id="suggestions2"></div>-->
<div id="3d-graph"></div>


<!--<iframe id="paralle" src="http://localhost:63342/3dgraph/paralle.html?_ijt=efq3rag27k95iltm337jb1a0fd&_ij_reload=RELOAD_ON_SAVE"></iframe>-->
<iframe id="paralle" ></iframe>

<label id="Caption">Ai ethics visual analysis platform</label>

<div class="checkbox-container">
    <div class="checkbox-item">
        <input type="checkbox" id="show_labels">
        <label for="show_labels" >Show all labels</label>

    </div>
    <div class="checkbox-item">
        <input type="checkbox" id="check3d">
        <label for="check3d">3D</label>
        <button id="plus_button">+</button>
        <button id="minus_button">-</button>
        <label  id="result">1 Case found</label>
    </div>
</div>
<div class="element-group">
    <label for="ai_dropdown" id="ai-caption">Label:</label>
    <select id="ai_dropdown">
        <option value="AI Ethics" selected>Select labels</option>
    </select>
    <select id="attribute_dropdown">
        <option value="AI Ethics" selected>Select labels</option>
    </select>
<!--    <input type="text" id="searchInput" placeholder="Search in label"/>-->

</div>




<table id="dataTable">
    <thead>
    <tr>
        <th>Node Label_Index</th>
        <th>Node Caption</th>
    </tr>
    </thead>
    <tbody>
    <!-- Rows will be added here dynamically -->
    </tbody>
</table>


<!--<div id="suggestions"></div>-->

<script>
    // const div = document.getElementById('3d-graph');
    // const width = div.clientWidth;
    // const height = div.clientHeight;
    //
    // // 创建 SVG 容器
    // const svg = d3.select("body").append("svg")
    //     .attr("width", width)
    //     .attr("height", height)
    //     .call(d3.zoom().on("zoom", zoomed)) // 添加缩放行为
    //     .append("g");
    var svg_num=0
    let isQueryRunning = false; // 标志来跟踪查询状态
    var listener_list =[]
    let clickCount = 0;  // To keep track of how many times the button has been clicked
    function getElementDistanceFromLeftEdge(element) {
        // 获取元素相对于视口的位置
        const rect = element.getBoundingClientRect();

        // 计算元素左边缘距离屏幕左边缘的距离
        const distance = rect.left + window.scrollX;

        return distance;
    }
    function setEqualDistanceFromLeftEdge(element1, element2) {
        // 计算第一个元素与屏幕左边缘的距离
        const distance = element1.getBoundingClientRect().left;

        // 应用相同的距离到第二个元素
        // 这里假设元素使用绝对定位或固定定位
        element2.style.left = distance + 'px';

        // 如果元素是相对定位或静态定位，您可能需要使用 marginLeft
        // element2.style.marginLeft = distance + 'px';
    }
    document.getElementById('plus_button').addEventListener('click', function() {
        // Increment the click count
        clickCount++;

        // var totalChildNodes = document.body.childNodes.length;

// 获取 document.body 的子元素总数，仅包括元素节点
        var totalChildElements = document.body.children.length;
        clickCount=totalChildElements-9
        // console.log("Total child nodes: " + totalChildNodes);
        console.log("Total child elements: " + totalChildElements);
        console.log('clickCount'+clickCount)
        // Clone the original element group
        const original = document.querySelector('.element-group');
        const clone = original.cloneNode(true);
        var top_var =document.querySelector('.element-group').getBoundingClientRect();
        // var rect = element.getBoundingClientRect();

        // 获取文档的垂直滚动距离
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;

        // 计算元素的顶部位置相对于文档的顶部的距离
        var top = top_var.top + scrollTop;
        console.log('top_var'+top)
        // Set the left position of the clone and the button based on the click count
        clone.style.top = (top + 50 * clickCount) + "px";
        // this.style.left = (600 + 500 * clickCount) + "px";  // Move the button
        // document.getElementById('result').style.left= (480 + 500 * clickCount) + "px";

        // Append the cloned group to the body or another container
        const originalChildren = original.querySelectorAll('[id]');
// 获取克隆元素的所有子元素
        const clonedChildren = clone.querySelectorAll('[id]');

// 遍历所有子元素并更新克隆元素的 id
        originalChildren.forEach((originalChild, index) => {
            const clonedChild = clonedChildren[index];
            const newId = originalChild.id + '_clone'+clickCount.toString();
            clonedChild.id = newId;
            // 现在 clonedChild 有了一个新的唯一 id
        });


        document.body.appendChild(clone);
        // 选择所有的 select 元素
        add_listener();


    });
    document.getElementById('minus_button').addEventListener('click', function() {
        // Increment the click count
        var totalChildElements = document.body.children.length;
        var lastChild = document.body.lastChild;

// 从 document.body 中移除这个子节点
        if (totalChildElements>10){
            document.body.removeChild(lastChild);
        }

    });

    const elem = document.getElementById('3d-graph');
    elem.style.zIndex=1;
    const driver = neo4j.driver("bolt://localhost", neo4j.auth.basic("neo4j", "12345678"),{encrypted: false});

    const session2 = driver.session({database:"neo4j"});
    var session_attribute = driver.session({database:"neo4j"});
    var session_get_index = driver.session({database:"neo4j"});
    session2.run("CALL db.labels()")
        .then(function(result) {
            var dropdown = document.getElementById('ai_dropdown'); // if this returns null, the next line will throw an error
            // dropdown.add(option);
            // console.log(result)
            result.records.forEach(function(record) {
                var option = document.createElement('option');
                option.value = record.get(0);
                option.text = record.get(0);
                dropdown.add(option);
            });

            // Close the session and driver
            session2.close();
            // driver.close();

        }).catch(error => {
        console.error(error);
    });

    const start = new Date()
    var iframe = document.getElementById("paralle");
    iframe.scrolling="no";
    document.body.appendChild(iframe);
    iframe.style.width = '300px';
    iframe.style.height = '120px';
    var src_="";
    iframe.onclick = function() {
        window.location.href = src_;
        console.log(src_); // "value2"
    }

    // const words = ["apple", "banana", "cherry", "date", "elderberry", "fig", "grape", "honeydew"];


    document.addEventListener('click', function(event) {
        console.log('Element clicked:', event.target);
        if (iframe.style.display==="block"){
            window.location.href = src_;
        }

    });
    session_elem("");

    add_listener();
    // 选择所有的 select 元素
    function add_listener(){
        const selects = document.querySelectorAll('select');
        // const selects_list =Array.from(selects);
        let idList = [];

// 遍历 DOM 列表
        selects.forEach(element => {
            idList.push(element.id); // 将每个元素的 id 添加到数组中
        });
        // let need_add_list = selects.filter(item => !listener_list.includes(item));
        // listener_list.forEach(item => selects_list.delete(item));

        let need_listen_list = idList.filter(item => !listener_list.includes(item));
        listener_list.push(need_listen_list)
        console.log("selects",need_listen_list)
        console.log("listener_list",listener_list)
        need_listen_list.forEach((select, index, array) => {
            // 检查 id 是否以 'aaa' 开头
            const select_dom=document.getElementById(select)
            console.log("select",select)
            if (select.startsWith('ai_dropdown')) {
                var nextId = array[index + 1];
                console.log("nextId",nextId)

                // 为符合条件的 select 元素添加事件监听器
                select_dom.addEventListener('change', (event) => {
                    // 这里是您想要执行的代码
                    var selectedOption = select_dom.options[select_dom.selectedIndex].text;
                    // var selectElement = document.getElementById("attribute_dropdown");

// 更改第一个选项的文本
//         selectElement.options[0].text = "Search in "+selectedOption;
                    // document.getElementById("attribute_dropdown").selectedIndex = 0;
                    // document.getElementById('attribute_dropdown').value = "Search in "+selectedOption;

                    const attribute_query = `
                 MATCH (n:\`${selectedOption}\`)
                        RETURN DISTINCT n.name;
                        `;
                    session_attribute.run(attribute_query)
                        .then(function(result) {
                            var dropdown = document.getElementById(nextId); // if this returns null, the next line will throw an error
                            // dropdown.add(option);
                            console.log("dropdown",dropdown,nextId)
                            // console.log(result)
                            if (dropdown) {
                                // 清空所有选项
                                dropdown.innerHTML = '';
                            }
                            result.records.forEach(function(record) {
                                var option = document.createElement('option');
                                option.value = record.get(0);
                                option.text = record.get(0);
                                if (!option.text.endsWith("_148")){
                                    dropdown.add(option);
                                }

                            });

                            // Close the session and driver
                            // session_attribute.close();
                            // driver.close();

                        }).catch(error => {
                        console.error(error);
                    });
                    var newOption = document.createElement("option");
                    // newOption.value =  "Search in "+selectedOption;
                    // newOption.text = "Search in "+selectedOption;

// 获取 <select> 元素
//                 var selectElement = document.getElementById("attribute_dropdown");

// 将新选项添加到 <select> 的最前面
//                     document.getElementById(nextId).insertBefore(newOption, document.getElementById(nextId).firstChild);
//
// 将这个新选项设为默认选中
                    // document.getElementById(nextId).value = "Search in "+selectedOption;
                    update_search();
                });
                select_dom.style.width = '200px';
                select_dom.style.marginRight = '20px';
            }else if (select.startsWith('attribute_dropdown')){
                select_dom.addEventListener('change', (event) => {
                    update_search()
                })
            }
        });
    }




    async function queryDatabase(condition) {
        var session_get_index = driver.session({database:"neo4j"});

        try {
            // 使用 await 等待查询结果
            const resultList = await session_get_index.run(condition);
            console.log("resultList", resultList); // 这里是您的列表
            var newList = resultList.records.map(function(record) {
                // 分割字符串
                var parts = record.get(0).split("_");
                // 返回分割后的第二部分（如果存在）
                return parts.length > 1 ? parts[1] : null;
            });

// 打印新列表以验证结果
//             console.log(newList);
            return newList
        } catch (error) {
            console.error("查询数据库时出错:", error);
        } finally {
            await session_get_index.close(); // 确保在结束时关闭会话
        }
    }
    function isNumeric(str) {
        if (typeof str != "string") return false; // 只处理字符串
        return !isNaN(str) && !isNaN(parseFloat(str));
    }
    async function update_search(){
        const selects = document.querySelectorAll('select');

// 使用 Array.from 方法将 NodeList 转换为数组
        const selectIds = Array.from(selects).map(select => select.id);

// 打印所有的 select 元素的 id
//         MATCH (n:Fields)
//         WHERE n.name = 'Autonomous Driving'
//         RETURN n.TrueLabel;

        let condition=""
        var index_lists=[]
        var num_list=[]
        // WHERE  n.TrueLabel CONTAINS "148"  and  NOT n.redundancy RETURN n.TrueLabel;
        for (const id of selectIds) {
            const index = selectIds.indexOf(id);


            let dropdown_str=document.getElementById(id).value



            if (id.startsWith('ai_dropdown')){
                if (!dropdown_str.includes(' ')) {
                    condition+=`MATCH (n:${dropdown_str})`;
                }
                else {
                    condition+=`MATCH (n:\`${dropdown_str}\`)`;
                }
            }else if (id.startsWith('attribute_dropdown')){
                // console.log("document.getElementById(id).value",document.getElementById(id).textContent)
                if (isNumeric(dropdown_str)){
                    condition += `WHERE n.name = ${dropdown_str} RETURN n.TrueLabel;`;
                }else if(dropdown_str.includes("'")) {
                    condition += `WHERE n.name = "${dropdown_str}" RETURN n.TrueLabel;`;
                }
                else {

                    condition += `WHERE n.name = '${dropdown_str}' RETURN n.TrueLabel;`;
                }


                console.log("condition",condition)
                try {
                    const result = await queryDatabase(condition);
                    console.log(condition, result);

                    index_lists = findCommonElements(index_lists, result);
                    // console.log("joint list1", index_lists);
                } catch (error) {
                    console.error("在获取列表时出错:", error);
                }



                // session_get_index.run(condition)
                //     .then(resultList => {
                //         console.log("resultList",resultList); // 这里是您的列表
                //     })
                condition=""
            }

        }
        console.log("joint list2",index_lists)
        // WHERE  n.TrueLabel CONTAINS "148"  and  NOT n.redundancy
        var query_str="WHERE "
        for (const [index, value] of   index_lists.entries()) {
            console.log(index,value)
            if (index===0){
                query_str+=` n.TrueLabel =~ \".*_${value}$\"  `
            }else {
                query_str+=` or  n.TrueLabel =~ \".*_${value}$\" `
            }

            // 在此处处理每个元素 id
        }
        query_str+=" and  NOT n.redundancy"
        console.log(query_str)
        if (index_lists.length!==0){
            session_elem(query_str);
        }
        document.getElementById('result').textContent=`${index_lists.length} Cases found`
        // console.log(condition);
        // console.log("index_list",index_list)
    }
    function findCommonElements(arr1, arr2) {
        if (arr1.length===0){
            arr1=arr2

        }
        // 使用 filter 方法来找到在 arr2 中也存在的 arr1 的元素
        console.log(arr1,arr2)
        return arr1.filter(function(element) {
            return arr2.includes(element);
        });
    }



    function two_d(nodes, links) {
        const idToColorMap = {};
        // 设置 SVG 尺寸
        const width = window.innerWidth;
        const height = window.innerHeight;
        // console.log(nodes)
        const tableBody = document.querySelector("#dataTable tbody");
        // const width = 800, height = 600;
        //
        // // 创建 SVG 容器
        // const svg = d3.select("body").append("svg")
        //     .attr("width", width)
        //     .attr("height", height)
        //     .call(d3.zoom().on("zoom", zoomed)) // 添加缩放行为
        //     .append("g");
        //
        // // 创建力导向图
        //

        update_row(nodes);

        // // 创建 SVG 容器
        let svg = d3.select("body").select("svg.fullscreen-svg");
        // let svgs = d3.select("2dsvg")

        d3.select("body").selectAll("svg").remove();


        svg = d3.select("body").append("svg")
            .attr("class", "fullscreen-svg") // 添加类名以便使用 CSS 设置样式
            // .attr("pointer-events", "all") // 确保 SVG 可以捕捉鼠标事件.
            //     .attr("width", "100%") // 假设你想要 SVG 充满其容器
            //     .attr("height", "100%")
            .call(d3.zoom().on("zoom", zoomed)) // 添加缩放行为
        .append("g");
        // let svgRect = svg.getBoundingClientRect();
        let table_head=document.getElementById('dataTable')
        // let table = document.querySelector("#dataTable tbody");
        //
        table_head.style.position = 'absolute';
        table_head.style.top = '100vh'; // 设置表格的顶部位置在视口高度之外
        table_head.style.zIndex = 2; // 确保表格在SVG之上
        // const container = svg.append("g");
        // const svg = d3.select("#3d-graph")
        //     .attr("width", "100%") // 假设你想要 SVG 充满其容器
        //     .attr("height", "100%")
        //     .attr("pointer-events", "all") // 确保 SVG 可以捕捉鼠标事件.
        // .call(d3.zoom().on("zoom", zoomed)) // 添加缩放行为

        // 创建力导向图
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id))
            .force("charge", d3.forceManyBody())
            .force("center", d3.forceCenter(width / 2, height / 2));

        // 创建链接线
        const link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("stroke-width", 2)
            .attr("stroke", "grey");

        // 创建节点
        const node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes)
            .enter().append("g")
            // .enter().append("circle")
            .attr("r", 5)
            // .attr("fill", d => getColorById(nodes.find(node => node.id === d.id).label)) // 为每个节点设置颜色
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended))
            .on("click", clicked); // 假设有一个 clicked 函数来处理点击事件

        function getLastPart(str) {
            const parts = str.split("_");
            return parts[parts.length - 1];
        }

        const circles = node.append("circle")
            .attr("r", 5)
            .attr("fill", d => getColorById(getLastPart(nodes.find(node => node.id === d.id).TrueLabel))) // 为每个节点设置颜色
            // .attr("fill", d => getColorById(nodes.find(node => node.id === d.id).label)) // 为每个节点设置颜色


        // 在节点旁添加文本
        const labels = node.append("text")
            .text(d => nodes.find(node => node.id === d.id).label) // 假设每个节点对象有一个 'id' 属性作为名称
            .attr("x", 6)
            .attr("y", 3);



        function getColorById(id) {
            // 如果这个 id 已经有一个颜色，就返回这个颜色
            if (idToColorMap[id]) {
                return idToColorMap[id];
            }

            // 否则，生成一个新的随机颜色
            const color = `hsl(${Math.random() * 360}, 100%, 50%)`; // 生成一个 HSL 颜色
            idToColorMap[id] = color;
            return color;
        }

        function clicked(event, d) {
            // 这里定义点击节点时的行为
            const nodeWithId223 = nodes.find(node => node.id === d.id);
            // const captionOfNode223 =  : undefined;

            // 例如：在控制台打印节点的信息
            console.log(`caption: ${nodeWithId223.caption}`+`\nlabel: ${nodeWithId223.label}`);
            console.log();
        }

        // 节点拖动函数
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // 缩放函数
        function zoomed(event) {
            svg.attr("transform", event.transform);
        }

        // 更新节点和链接的位置
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });
    }
    function update_row(nodes){
        const tableBody = document.querySelector("#dataTable tbody");
        tableBody.innerHTML = "";
        nodes.forEach(node => {
            // console.log(node)


            const row = document.createElement('tr');

            const labelCell = document.createElement('td');
            labelCell.textContent = node.TrueLabel;

            const captionCell = document.createElement('td');
            captionCell.textContent = node.caption;


            row.appendChild(labelCell);
            row.appendChild(captionCell);
            tableBody.appendChild(row);
            // const sprite = new THREE.TextSprite({
            //     fontSize:5, // 适当调整
            //     color: 'white',
            //     text: node.label +"  :  "+ node.caption,
            // });

            // const group = new THREE.Group();
            // group.add(sprite);
            // return group;
        })
    }
    function three_d(nodes, links){

        console.log(links.length+" links loaded in "+(new Date()-start)+" ms.")
        const gData = { nodes: Object.values(nodes), links: links}
        const nodeCaption = document.getElementById('node-picture');
        let mouseX = 0;
        let mouseY = 0;
        let boxX = 0;
        let boxY = 0;
        const boxOffsetX = 10;
        const boxOffsetY = 10;
        const tableBody = document.querySelector("#dataTable tbody");
        const Graph = ForceGraph3D()(elem)
            .graphData(gData)
            .nodeAutoColorBy('label')
            .nodeLabel(node => `${node.label}: ${node.caption}`)
            .onNodeHover(node => {
                if (node) {
                    //
                    // if (node.label==="Sum"){
                    //     iframe.style.width = '300px';
                    //     iframe.style.height = '120px';
                    //     iframe.style.backgroundColor = 'white';
                    //     iframe.src="http://localhost:63342/3dgraph/paralle.html?param1="+node.label+"&param2="+node.caption+"&param3="+"small"
                    //     src_="http://localhost:63342/3dgraph/paralle.html?param1="+node.label+"&param2="+node.caption+"&param3="+"big"
                    // }
                    // else {
                    //
                    //     //iframe.style.width = '150px';
                    //     //iframe.style.height = '150px';
                    //     //iframe.style.backgroundColor = 'transparent';
                    //     //iframe.src="http://localhost:63342/3dgraph/leida2.html?param1="+node.label+"&param2="+node.caption+"&param3="+"small"
                    //     //src_="http://localhost:63342/3dgraph/leida2.html?param1="+node.label+"&param2="+node.caption+"&param3="+"big"
                    //
                    //
                    //
                    //     iframe.style.width = '900px';
                    //     iframe.style.height = '240px';
                    //     iframe.style.backgroundColor = 'white';
                    //     // iframe.src="http://localhost:63342/3dgraph/paralle.html?param1="+node.label+"&param2="+node.caption+"&param3="+"small"
                    //     iframe.src="http://localhost:63342/3dgraph/paralle.html?param1=AI_case&param2=part1&param3=small"
                    //     // src_="http://localhost:63342/3dgraph/paralle.html?param1="+node.label+"&param2="+node.caption+"&param3="+"big"
                    //     src_="http://localhost:63342/3dgraph/paralle.html?param1=AI_case&param2=part1&param3=big"
                    // }
                    //
                    // iframe.style.display="block"

                } else {
                    iframe.style.display="none"
                    // nodeCaption.value = "";
                }
                //nodeCaption.style.display = nodeCaption.value ? 'inline-block' : 'none';
            });

        update_row(nodes);
        // const checkbox = document.getElementById('show_labels');
        // if (checkbox.checked) {
        //     // 启用 .nodeThreeObject 属性
        //     update_row();
        // } else {
        //     // 禁用 .nodeThreeObject 属性
        //     Graph.nodeThreeObject(null); // 将 .nodeThreeObject 设置为 null
        // }
        // function update_row(){
        //     tableBody.innerHTML = "";
        //     Graph.nodeThreeObject(node => {
        //
        //
        //         const row = document.createElement('tr');
        //
        //         const labelCell = document.createElement('td');
        //         labelCell.textContent = node.TrueLabel;
        //
        //         const captionCell = document.createElement('td');
        //         captionCell.textContent = node.caption;
        //
        //
        //         row.appendChild(labelCell);
        //         row.appendChild(captionCell);
        //         tableBody.appendChild(row);
        //         // const sprite = new THREE.TextSprite({
        //         //     fontSize:5, // 适当调整
        //         //     color: 'white',
        //         //     text: node.label +"  :  "+ node.caption,
        //         // });
        //
        //         // const group = new THREE.Group();
        //         // group.add(sprite);
        //         // return group;
        //     })
        // }

        // checkbox.addEventListener('change', function () {
        //     if (checkbox.checked) {
        //         // 启用 .nodeThreeObject 属性
        //         update_row();
        //     } else {
        //         // 禁用 .nodeThreeObject 属性
        //         Graph.nodeThreeObject(null); // 将 .nodeThreeObject 设置为 null
        //     }
        // });
        document.addEventListener('mousemove', e => {
            if (Graph) {
                if (iframe.style.display==="block"){
                    const x = e.clientX + 100; // 10是文本框与鼠标的水平偏移量
                    const y = e.clientY - 230; // 10是文本框与鼠标的垂直偏移量
                    iframe.style.left = x + 'px';
                    iframe.style.top = y + 'px';
                }

            }
        });
    }
    function session_elem(condition){
        var session = driver.session({database:"neo4j"});

        session
            // .run(
                // `MATCH (n)-->(m)
                // WHERE  n.TrueLabel CONTAINS "148" or n.TrueLabel CONTAINS "123" and  NOT n.redundancy
                // RETURN { id: id(n), label:head(labels(n)), caption:n.name } as source, { id: id(m), label:head(labels(m)), caption:m.name } as target LIMIT $limit`, {limit: neo4j.int(5000)})
            //
            .run('MATCH (n)-->(m) \n' +condition+
                '\nRETURN { id: id(n), label:head(labels(n)), caption:n.name, TrueLabel:n.TrueLabel } as source, { id: id(m), label:head(labels(m)), caption:m.name, TrueLabel:m.TrueLabel } as target LIMIT $limit', {limit: neo4j.int(500)})
            // .run("MATCH (n)\n" +
            //     "UNWIND labels(n) AS label\n" +
            //     "RETURN DISTINCT label\n")
            .then(function (result) {

                console.log("result",result)
                const nodes = {}
                const links = result.records.map(r => {
                    var source = r.get('source');source.id = source.id.toNumber();
                    nodes[source.id] = source;
                    var target = r.get('target');target.id = target.id.toNumber();
                    nodes[target.id] = target;
                    return {source:source.id,target:target.id}
                });
                session.close();


                // three_d()
                const checkbox_3d=document.getElementById('check3d')
                checkbox_3d.addEventListener('change', function () {

                    if (checkbox_3d.checked) {
                        // 启用 .nodeThreeObject 属性
                        d3.select("body").selectAll("svg").remove();
                        three_d(Object.values(nodes), links)
                    } else {
                        // 禁用 .nodeThreeObject 属性
                        document.getElementById('3d-graph').innerHTML = '';

                        two_d( Object.values(nodes), links);
                    }
                });
                if (checkbox_3d.checked) {
                    // 启用 .nodeThreeObject 属性
                    three_d(Object.values(nodes), links)
                } else {
                    // 禁用 .nodeThreeObject 属性

                    two_d( Object.values(nodes), links);
                }




            })
            .catch(function (error) {
                console.log(error);
            }
            );
}

</script>
</body>